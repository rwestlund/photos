<!--
    Copyright (c) 2016. Randy Westlund and Jacqueline Kory Westlund.
    All rights reserved.
    This code is under the BSD-2-Clause license.
-->

<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="photo-form">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment">

            .photo-item-label {
                padding-top: 1.2em;
                display: block;
            }

            .tag-item {
                margin-right: 1em;
                padding-right: 1em;
            }

        </style>

        <iron-ajax
            auto
            method="GET"
            url="/api/tags"
            handle-as="json"
            last-response="{{tags}}">
        </iron-ajax>

        <responsive-dialog id="dialog"
                title="Edit photo"
                dismiss-text="Cancel"
                confirm-text="Save"
                on-iron-overlay-closed="resolve_dialog">
            <paper-input
                    type="text"
                    label="Caption"
                    value="{{photo.caption}}"
                    autocapitalize="sentences"
                    char-counter maxlength="140">
            </paper-input>

            <strong class="photo-item-label">Tags</strong>
                <div class="layout horizontal wrap">
                    <template is="dom-repeat" items="[[photo.tags]]">
                        <paper-material class="tag-item">
                            <paper-icon-button
                                    icon="icons:cancel"
                                    data-index$="[[index]]"
                                    on-tap="remove_tag">
                            </paper-icon-button>
                            <span>[[item]]</span>
                        </paper-material>
                    </template>
                </div>

            <div class="layout vertical">
                <paper-dropdown-menu
                        label="Select Tags"
                        vertical-align="top"
                        horizontal-align="right">
                    <paper-menu class="dropdown-content"
                                attr-for-selected="value"
                                selected="{{selected_tag}}"
                                on-iron-select="add_selected_tag">
                        <template is="dom-repeat" items="[[tags]]">
                            <paper-item value="[[item.name]]">
                                [[item.name]]
                            </paper-item>
                        </template>
                    </paper-menu>
                </paper-dropdown-menu>
            </div>
        </responsive-dialog>
    </template>

    <script>
        'use strict';
        Polymer({
            is: "photo-form",
            behaviors: [ photo_behaviors.form_behavior ],
            properties: {
                photo: {
                    type: Object,
                },
            },
            // Add a tag to the tag list, checking for duplicates first.
            add_selected_tag: function() {
                for (var i in this.photo.tags)
                    if (this.photo.tags[i] === this.selected_tag) return;
                this.push('photo.tags', this.selected_tag);
            },
            remove_tag: function(e) {
                var index = Number(
                        e.currentTarget.attributes['data-index'].value);
                this.splice('photo.tags', index, 1);
            },
        })
    </script>
</dom-module>
