<!--
    Copyright (c) 2016. Randy Westlund and Jacqueline Kory Westlund.
    All rights reserved.
    This code is under the BSD-2-Clause license.
-->

<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="photo-collection">
    <template>
        <style is="custom-style" include="app-grid-style"></style>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
        </style>
        <style is="custom-style" include="global-styles"></style>
        <style>
            :host {
                display: block;
                    --app-grid-columns: 2;
                    --app-grid-gutter: 15px;
            }
            @media (max-width: 800px) {
                :host {
                    --app-grid-columns: 1;
                }
            }
            span.tag_image_count {
                color: gray;
                font-size: large;
                font-style: italic;
            }

        </style>

        <iron-ajax
            auto
            method="GET"
            url="/api/photos"
            params="[[search_filter]]"
            handle-as="json"
            last-response="{{photos}}">
        </iron-ajax>


        <template is="dom-if" if="[[tagName]]">
             <iron-ajax
                auto="[[tagName]]"
                method="GET"
                url="/api/tags/[[tagName]]"
                handle-as="json"
                last-response="{{tag}}">
            </iron-ajax>

            <div class="layout horizontal justified">
                <span class="page_name">[[tagName]]</span>
                <span class="tag_image_count">
                    [[pretty_image_count(tag.image_count)]]
                </span>
            </div>
        </template>

        <template is="dom-if" if="[[!photos.length]]">
            <h4>This album has no photos!</h4>
        </template>

        <div class="app-grid">
            <template is="dom-repeat" items="[[photos]]">
                <photo-display photo="[[item]]"></photo-display>
            </template>
        </div>
    </template>

    <script>
        'use strict';
        Polymer({
            is: "photo-collection",
            behaviors: [photo_behaviors.global_behavior],
            properties: {
                tagName: {
                    type: String,
                },
                search_filter: {
                    type: Object,
                    computed: "compute_search_filter(tagName)",
                }
            },
            compute_search_filter: function(tag) {
                var o = {};
                if (tag) o.tag= tag;
                return o;
            },
            // Reevaluated the app-grid styles on resize.
            attached: function() {
                window.addEventListener("resize", () => this.updateStyles());
            },
        })
    </script>
</dom-module>
