<!--
    Copyright (c) 2016. Randy Westlund and Jacqueline Kory Westlund.
    All rights reserved.
    This code is under the BSD-2-Clause license.
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/vaadin-upload/vaadin-upload.html">

<dom-module id="photos-uploads">
    <template>
        <style is="custom-style" include="global-styles"></style>
        <style>
            :host {
                display: block;

                --vaadin-upload-drop-label: {
                    color: var(--secondary-text-color);
                }
            }
            vaadin-upload {
                --primary-color: var(--header-background-color);
                --light-primary-color: var(--medium-background-color);
                background-color: #ffffff;
                margin-top: 1em;
            }
            vaadin-upload[nodrop] {
                background-color: inherit;
            }
            paper-button iron-icon {
                margin-right: 1em;
            }

        </style>

        <paper-button raised on-tap="select_albums">
            <iron-icon icon="image:photo-library"></iron-icon>
            Set albums for uploads
        </paper-button>

        <template is="dom-if" if="[[albums_selected.length]]">
            <p><strong>Selected albums:</strong>
                <ul>
                    <template is="dom-repeat" items="[[albums_selected]]">
                        <li>[[item]]</li>
                    </template>
                </ul>
            </p>
        </template>

        <vaadin-upload target="/api/photos" accept="image/*,video/*"
                        on-upload-request="handle_upload_request">
            <div class="drop-label">
                <iron-icon icon="icons:file-upload"></iron-icon>
                Drag photos here!
            </div>
        </vaadin-upload>


    </template>

    <script>
        'use strict';
        Polymer({
            is: "photos-uploads",
            properties: {
                albums_selected: {
                    type: Array,
                    value: []
                }
            },
            select_albums: function() {
                // Deep copy the object so we don't change the card's
                // display until the save is successful.
                this.set("edit_albums_selected",
                        JSON.parse(JSON.stringify(this.albums_selected)));
                // Ask for the form to be opened.
                this.fire("iron-signal", { name: "open-form",
                    data: {
                        name:               "select_album_form",
                        selectedAlbums:     this.edit_albums_selected,
                        that:               this,
                        callback:           "resolve_album_select_dialog",
                    },
                });
            },
            handle_upload_request: function(e, data) {
                data.formData.append("albums",
                        JSON.stringify(this.albums_selected));
            },
            // Handle response from dialog. Reason is either confirmed or
            // canceled.
            resolve_album_select_dialog: function(e, reason) {
                if (!reason.confirmed) return;
                this.set("albums_selected", this.edit_albums_selected);
            },
        })
    </script>
</dom-module>
